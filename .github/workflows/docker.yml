name: Docker CI/CD Pipeline

on:
  push:
    branches: [ main ]
#   pull_request:
#     branches: [ main ]

jobs:
  continuous-integration:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    
#     - name: Set up Docker Buildx
#       uses: docker/setup-buildx-action@v1

    - name: Login to dockerhub
      run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
    
    - name: Build Docker Dev Front
      run: docker build -t ${{ secrets.DOCKER_USERNAME }}/docker_front -f ./front/Dockerfile.dev ./front
    
#     - name: Run Test
#       run: docker run -e CI=true ${{ secrets.DOCKER_USERNAME }}/docker_front npm run test -- --coverage
    
    - name: Build Docker Front image
      run: docker build -t ${{ secrets.DOCKER_USERNAME }}/docker_front ./front
    - name: Build Docker Back image
      run: docker build -t ${{ secrets.DOCKER_USERNAME }}/docker_back ./back
    - name: Build Docker Nginx image
      run: docker build -t ${{ secrets.DOCKER_USERNAME }}/docker_nginx ./nginx
    - name: Push Docker Front image to DockerHub
      run: docker push ${{ secrets.DOCKER_USERNAME }}/docker_front
    - name: Push Docker Back image to DockerHub
      run: docker push ${{ secrets.DOCKER_USERNAME }}/docker_back
    - name: Push Docker Nginx image to DockerHub
      run: docker push ${{ secrets.DOCKER_USERNAME }}/docker_nginx
          
        
#   continuous-deployment:
#     runs-on: ubuntu-latest
#     needs: [continuous-integration]
#     steps:
